<input type="text" id="phone" placeholder="Enter WhatsApp number" />
<button id="generate">Generate Maxx XMD Code</button>

<input type="text" id="code" placeholder="Enter code from WhatsApp" />
<button id="verify">Verify Code</button>

<div id="sessionInfo"></div>

<script>
const phoneInput = document.getElementById("phone");
const codeInput = document.getElementById("code");
const sessionInfo = document.getElementById("sessionInfo");

document.getElementById("generate").onclick = async () => {
  const number = phoneInput.value.trim();
  if(!number) return alert("Enter WhatsApp number");
  const btn = document.getElementById("generate");
  btn.disabled = true;

  try {
    const res = await fetch("/generate", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({ number })
    });
    const data = await res.json();
    if(data.success) sessionInfo.innerHTML = `✅ Code sent to WhatsApp`;
    else alert(data.error || "Failed to generate code");
  } catch(e) { alert("❌ Error generating code"); }
  btn.disabled = false;
};

document.getElementById("verify").onclick = async () => {
  const number = phoneInput.value.trim();
  const code = codeInput.value.trim();
  if(!number || !code) return alert("Enter number and code");
  const btn = document.getElementById("verify");
  btn.disabled = true;

  try {
    const res = await fetch("/verify", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({ number, code })
    });
    const data = await res.json();
    if(data.success) sessionInfo.innerHTML = `✅ Session linked! ID: ${data.sessionId}`;
    else alert(data.error || "Invalid code");
  } catch(e) { alert("❌ Error verifying code"); }
  btn.disabled = false;
};
</script>
